<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caesar Cipher & Frequency Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Existing styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px auto;
            max-width: 2000px;
            padding: 20px;
            color: #333;
            background: #f4f4f9;
        }

        h1 {
            text-align: center;
            color: #444;
        }

        textarea,
        input {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            background: #fff;
        }

        textarea {
            height: 120px;
        }

        button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 16px;
            color: #fff;
            background: #007BFF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .shift-display {
            text-align: center;
            margin: 10px 0;
            font-size: 18px;
            color: #666;
        }

        .charts-container {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .chart {
            width: 45%;
        }
    </style>
</head>

<body>
    <h1>Caesar Cipher & Frequency Analysis</h1>
    <textarea id="inputText" placeholder="Enter your text here..."></textarea>
    <button onclick="encryptText()">Encrypt Text</button>
    <div class="shift-display" id="shiftDisplay">Random Shift: Not Applied Yet</div>
    <textarea id="decodedOutput" placeholder="Decoded text will appear here..." readonly></textarea>
    <select id="decodingMethod" onchange="clearDecodedOutput()">
        <option value="frequency">Frequency Analysis</option>
        <option value="bruteforce">Bruteforce</option>
    </select>
    <button onclick="decodeText()">Decode Text</button>

    <h1>Caesar Cipher Explanation</h1>

    <!-- Charts Container -->
    <div class="charts-container">
        <div class="chart">
            <h2>Original Text Frequency</h2>
            <canvas id="originalChart"></canvas>
        </div>
        <div class="chart">
            <h2>Ciphered Text Frequency</h2>
            <canvas id="cipheredChart"></canvas>
        </div>
    </div>

    <script>
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const englishFrequencies = 'ETAOINSHRDLCUMWFGYPBVKJXQZ'; // Ordered by frequency in English
        let shift = 0;
        let originalText = '';
        let cipheredText = '';

        let originalChartInstance = null;
        let cipheredChartInstance = null;

        function countFrequencies(text) {
            const frequencies = Array(26).fill(0); // Initialize A-Z with zero frequency
            text.toUpperCase().split('').forEach(char => {
                if (alphabet.includes(char)) {
                    frequencies[alphabet.indexOf(char)]++;
                }
            });
            return frequencies;
        }

        function encryptText() {
            originalText = document.getElementById('inputText').value.toUpperCase();
            if (!originalText) {
                alert('Please enter some text!');
                return;
            }
            shift = Math.floor(Math.random() * 26); // Random shift between 0-25
            cipheredText = originalText.split('').map(char => {
                if (alphabet.includes(char)) {
                    const index = (alphabet.indexOf(char) + shift) % 26;
                    return alphabet[index];
                }
                return char; // Non-alphabet characters remain unchanged
            }).join('');

            document.getElementById('shiftDisplay').innerText = `Random Shift: ${shift}`;
            updateCharts(); // Update charts after encryption
        }

        function decodeText() {
            const decodingMethod = document.getElementById('decodingMethod').value;
            if (!cipheredText) {
                alert('Please encrypt text first!');
                return;
            }

            let decodedText = '';
            if (decodingMethod === 'frequency') {
                decodedText = decodeWithFrequencyAnalysis();
            } else if (decodingMethod === 'bruteforce') {
                decodedText = decodeWithBruteforce();
            }

            animateDecodedText(decodedText); // Call the animation function after decoding
        }

        function decodeWithFrequencyAnalysis() {
            const cipheredFrequencies = countFrequencies(cipheredText);
            const mostFrequentCipheredIndex = cipheredFrequencies.indexOf(Math.max(...cipheredFrequencies));
            const mostFrequentCipheredLetter = alphabet[mostFrequentCipheredIndex];

            // Align with 'E' as the most common English letter
            const estimatedShift = (mostFrequentCipheredIndex - alphabet.indexOf('E') + 26) % 26;

            return cipheredText.split('').map(char => {
                if (alphabet.includes(char)) {
                    const index = (alphabet.indexOf(char) - estimatedShift + 26) % 26;
                    return alphabet[index];
                }
                return char;
            }).join('');
        }

        function decodeWithBruteforce() {
            let possibleDecodings = [];
            for (let i = 0; i < 26; i++) {
                const decodedAttempt = cipheredText.split('').map(char => {
                    if (alphabet.includes(char)) {
                        const index = (alphabet.indexOf(char) - i + 26) % 26;
                        return alphabet[index];
                    }
                    return char;
                }).join('');

                // Confronta la decodifica con il testo originale
                if (decodedAttempt.toUpperCase() === originalText.toUpperCase()) {
                    possibleDecodings.push(decodedAttempt);
                }
            }

            // Se troviamo la decodifica corretta, la mostriamo
            return possibleDecodings.length > 0 ? possibleDecodings[0] : "No matching decoding found.";
        }

        // Funzione per svuotare la text area di output al cambio dell'opzione nel menu
        function clearDecodedOutput() {
            document.getElementById('decodedOutput').value = '';
        }

        // Funzione per aggiornare i grafici
        function updateCharts() {
            const originalFrequencies = countFrequencies(originalText);
            const cipheredFrequencies = countFrequencies(cipheredText);

            // Dati per i grafici
            const dataOriginal = {
                labels: alphabet.split(''),
                datasets: [{
                    label: 'Original Text Frequency',
                    data: originalFrequencies,
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            };

            const dataCiphered = {
                labels: alphabet.split(''),
                datasets: [{
                    label: 'Ciphered Text Frequency',
                    data: cipheredFrequencies,
                    backgroundColor: 'rgba(153, 102, 255, 0.6)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            };

            // Configurazione dei grafici
            const config = {
                type: 'bar',
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            // Destroy the old charts if they exist
            if (originalChartInstance) {
                originalChartInstance.destroy();
            }

            if (cipheredChartInstance) {
                cipheredChartInstance.destroy();
            }

            // Create the new charts
            originalChartInstance = new Chart(document.getElementById('originalChart'), {
                ...config,
                data: dataOriginal
            });

            cipheredChartInstance = new Chart(document.getElementById('cipheredChart'), {
                ...config,
                data: dataCiphered
            });
        }

        // Funzione per animare il testo decodificato
        function animateDecodedText(decodedText) {
            let index = 0;
            const decodedOutput = document.getElementById('decodedOutput');
            decodedOutput.value = ''; // Pulisce il campo prima di iniziare l'animazione

            // Modifica qui l'intervallo per aumentare la velocità
            const speed = 1; // Riduci questo valore per aumentare la velocità (minore è il numero, più veloce è l'animazione)

            const interval = setInterval(() => {
                decodedOutput.value += decodedText[index];
                index++;
                if (index === decodedText.length) {
                    clearInterval(interval);
                }
            }, speed);
        }
    </script>
</body>

</html>
